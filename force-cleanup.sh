#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏ –±—ç–∫–∞–ø–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
# –ó–∞–ø—É—Å–∫: ssh user@server "bash -s" < force-cleanup.sh

echo "üßπ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –±—ç–∫–∞–ø–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ..."

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd /var/www/reguides || {
    echo "‚ùå –û—à–∏–±–∫–∞: –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è /var/www/reguides –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
    exit 1
}

echo "üìÅ –¢–µ–∫—É—â–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: $(pwd)"

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–µ –±—ç–∫–∞–ø—ã
echo "üìã –¢–µ–∫—É—â–∏–µ –±—ç–∫–∞–ø—ã:"
ls -la .next.backup.* 2>/dev/null || echo "   –ù–µ—Ç –±—ç–∫–∞–ø–æ–≤"

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –±—ç–∫–∞–ø–æ–≤
echo "üíæ –†–∞–∑–º–µ—Ä –±—ç–∫–∞–ø–æ–≤:"
du -sh .next.backup.* 2>/dev/null || echo "   –ù–µ—Ç –±—ç–∫–∞–ø–æ–≤"

# –£–¥–∞–ª—è–µ–º –í–°–ï –±—ç–∫–∞–ø—ã
echo "üóëÔ∏è  –£–¥–∞–ª—è–µ–º –í–°–ï –±—ç–∫–∞–ø—ã..."
rm -rf .next.backup.* 2>/dev/null

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
if [ $? -eq 0 ]; then
    echo "‚úÖ –í—Å–µ –±—ç–∫–∞–ø—ã —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω—ã"
else
    echo "‚ö†Ô∏è  –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –±—ç–∫–∞–ø—ã –Ω–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å"
fi

# –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ –∞—Ä—Ö–∏–≤—ã
echo "üóëÔ∏è  –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –∞—Ä—Ö–∏–≤—ã..."
rm -f build.tar.gz.* 2>/dev/null
rm -f *.tar.gz 2>/dev/null

# –û—á–∏—â–∞–µ–º –ª–æ–≥–∏ PM2
echo "üßπ –û—á–∏—â–∞–µ–º –ª–æ–≥–∏ PM2..."
pm2 flush 2>/dev/null || echo "   PM2 –Ω–µ –∑–∞–ø—É—â–µ–Ω"

# –û—á–∏—â–∞–µ–º –∫—ç—à npm
echo "üßπ –û—á–∏—â–∞–µ–º –∫—ç—à npm..."
npm cache clean --force 2>/dev/null || echo "   npm cache –Ω–µ –Ω–∞–π–¥–µ–Ω"

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–Ω–æ–µ –º–µ—Å—Ç–æ
echo "üíæ –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–Ω–æ–µ –º–µ—Å—Ç–æ:"
df -h /var/www/reguides

echo "‚úÖ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
echo "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:"
echo "   –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: $(pwd)"
echo "   –°–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ: $(df -h /var/www/reguides | tail -1 | awk '{print $4}')"
echo "   –†–∞–∑–º–µ—Ä –ø—Ä–æ–µ–∫—Ç–∞: $(du -sh . | awk '{print $1}')"
