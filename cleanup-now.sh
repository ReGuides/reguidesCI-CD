#!/bin/bash

# –ü—Ä–æ—Å—Ç–∞—è –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏ –±–µ–∫–∞–ø–æ–≤
# –í—ã–ø–æ–ª–Ω–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ: bash cleanup-now.sh

echo "üßπ –ù–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –±–µ–∫–∞–ø–æ–≤..."

cd /var/www/reguides

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
current_count=$(ls -1 .next.backup.* 2>/dev/null | wc -l)
echo "üìä –¢–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–µ–∫–∞–ø–æ–≤: $current_count"

if [ "$current_count" -gt 2 ]; then
    echo "üóëÔ∏è  –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –±–µ–∫–∞–ø—ã (–æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ 2)..."
    
    # –£–¥–∞–ª—è–µ–º –≤—Å–µ –∫—Ä–æ–º–µ 2 —Å–∞–º—ã—Ö –Ω–æ–≤—ã—Ö
    ls -t .next.backup.* 2>/dev/null | tail -n +3 | xargs -r rm -rf
    
    echo "‚úÖ –û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    remaining_count=$(ls -1 .next.backup.* 2>/dev/null | wc -l)
    echo "üìä –û—Å—Ç–∞–≤—à–∏—Ö—Å—è –±–µ–∫–∞–ø–æ–≤: $remaining_count"
    
    echo "üìÅ –û—Å—Ç–∞–≤—à–∏–µ—Å—è –±–µ–∫–∞–ø—ã:"
    ls -la .next.backup.* 2>/dev/null
else
    echo "‚ÑπÔ∏è  –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–µ–∫–∞–ø–æ–≤ ($current_count) –Ω–µ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ª–∏–º–∏—Ç (2)"
fi

echo "üíæ –†–∞–∑–º–µ—Ä –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:"
du -sh /var/www/reguides
