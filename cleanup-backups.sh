#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ —Å—Ç–∞—Ä—ã—Ö –±–µ–∫–∞–ø–æ–≤
# –û—Å—Ç–∞–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ 2 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –±–µ–∫–∞–ø–∞

echo "üßπ –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –±–µ–∫–∞–ø–æ–≤..."

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd /var/www/reguides || { echo "‚ùå –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è /var/www/reguides –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"; exit 1; }

echo "üìÅ –¢–µ–∫—É—â–∏–µ –±–µ–∫–∞–ø—ã:"
ls -la .next.backup.* 2>/dev/null || echo "   –ë–µ–∫–∞–ø—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"

# –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–µ–∫–∞–ø–æ–≤
backup_count=$(ls -1 .next.backup.* 2>/dev/null | wc -l)

if [ "$backup_count" -gt 2 ]; then
    echo "üóëÔ∏è  –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –±–µ–∫–∞–ø—ã (–æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ 2 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö):"
    ls -t .next.backup.* 2>/dev/null | tail -n +3 | xargs -r rm -rf
    echo "‚úÖ –°—Ç–∞—Ä—ã–µ –±–µ–∫–∞–ø—ã —É–¥–∞–ª–µ–Ω—ã"
else
    echo "‚ÑπÔ∏è  –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–µ–∫–∞–ø–æ–≤ ($backup_count) –Ω–µ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ª–∏–º–∏—Ç (2)"
fi

echo "üìÅ –û—Å—Ç–∞–≤—à–∏–µ—Å—è –±–µ–∫–∞–ø—ã:"
ls -la .next.backup.* 2>/dev/null || echo "   –ë–µ–∫–∞–ø—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"

# –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ –∞—Ä—Ö–∏–≤—ã
echo "üóëÔ∏è  –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∞—Ä—Ö–∏–≤–æ–≤:"
ls -la build.tar.gz.* 2>/dev/null | head -n -2 | awk '{print $9}' | xargs -r rm -f

echo "‚úÖ –û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
