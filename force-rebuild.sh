#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏ –∏ –æ—á–∏—Å—Ç–∫–∏ –∫—ç—à–∞
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./force-rebuild.sh

echo "üîÑ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –∏ –æ—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞..."

# –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º PM2
echo "üõë –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º PM2..."
pm2 stop reguides-nextjs

# –û—á–∏—â–∞–µ–º –≤—Å–µ –∫—ç—à–∏
echo "üßπ –û—á–∏—â–∞–µ–º –∫—ç—à–∏..."
rm -rf /var/www/reguides/.next
rm -rf /var/www/reguides/node_modules/.cache
rm -rf /var/www/reguides/.next/cache

# –û—á–∏—â–∞–µ–º –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞ –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤
echo "‚è∞ –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ñ–∞–π–ª–æ–≤..."
find /var/www/reguides/.next/static -name "*.js" -exec touch {} \; 2>/dev/null || true
find /var/www/reguides/.next/static -name "*.css" -exec touch {} \; 2>/dev/null || true

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º PM2
echo "üöÄ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º PM2..."
pm2 start ecosystem.config.js --env production

# –ñ–¥–µ–º –∑–∞–ø—É—Å–∫–∞
echo "‚è≥ –ñ–¥–µ–º –∑–∞–ø—É—Å–∫–∞..."
sleep 5

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å
echo "üìã –°—Ç–∞—Ç—É—Å PM2:"
pm2 list | grep reguides-nextjs

echo "‚úÖ –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
echo "üí° –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ –±—Ä–∞—É–∑–µ—Ä–µ (Ctrl+F5)"
