# 🚨 Немедленная очистка бекапов

## Проблема
На сервере накопилось огромное количество бекапов (219 штук), что занимает много места на диске.

## Решение

### Вариант 1: Простая команда (рекомендуется)

Выполните на сервере одну команду:

```bash
cd /var/www/reguides && ls -t .next.backup.* 2>/dev/null | tail -n +3 | xargs -r rm -rf
```

Эта команда:
- ✅ Удаляет все бекапы кроме 2 самых новых
- ✅ Работает мгновенно
- ✅ Безопасна (оставляет 2 последних бекапа)

### Вариант 2: С проверкой

```bash
cd /var/www/reguides

# Показываем количество бекапов
echo "Текущее количество бекапов: $(ls -1 .next.backup.* 2>/dev/null | wc -l)"

# Показываем какие останутся
echo "Останутся (2 самых новых):"
ls -t .next.backup.* 2>/dev/null | head -2

# Удаляем старые
ls -t .next.backup.* 2>/dev/null | tail -n +3 | xargs -r rm -rf

echo "Очистка завершена!"
```

### Вариант 3: Через SSH из локальной машины

```bash
# Подключиться к серверу
ssh username@your-server-ip

# Выполнить очистку
cd /var/www/reguides
ls -t .next.backup.* 2>/dev/null | tail -n +3 | xargs -r rm -rf
```

## Проверка результата

После очистки проверьте:

```bash
cd /var/www/reguides

# Количество бекапов
ls -1 .next.backup.* 2>/dev/null | wc -l

# Список оставшихся бекапов
ls -la .next.backup.*

# Размер директории
du -sh /var/www/reguides
```

## Что произойдет

- **До очистки**: 219 бекапов
- **После очистки**: 2 бекапа (самых новых)
- **Освобожденное место**: ~90% от текущего размера

## Безопасность

- ✅ Остаются 2 самых новых бекапа
- ✅ Можно восстановиться из любого из них
- ✅ Приложение продолжает работать
- ✅ При следующих деплоях будет автоматическая очистка

## Автоматическая очистка в будущем

После этой ручной очистки, при каждом деплое через GitHub Actions будет автоматически:
- Создаваться новый бекап
- Удаляться старые бекапы (оставляться только 2)
- Очищаться старые архивы

## Восстановление из бекапа (если нужно)

```bash
cd /var/www/reguides

# Остановить приложение
pm2 stop reguides-nextjs

# Восстановить из бекапа
rm -rf .next
mv .next.backup.YYYYMMDD_HHMMSS .next

# Запустить приложение
pm2 start ecosystem.config.js --env production
```

## Мониторинг

Для мониторинга размера бекапов в будущем:

```bash
# Размер всех бекапов
du -sh .next.backup.*

# Общий размер директории
du -sh /var/www/reguides

# Количество бекапов
ls -1 .next.backup.* 2>/dev/null | wc -l
```
